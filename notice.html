<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Notice Board</title>
  <style>
    body {
      background: #000;
      color: #fff;
      font-family: sans-serif;
      padding: 20px;
    }
    #editorPanel {
      display: none;
    }
    input, textarea {
      display: block;
      margin: 10px 0;
      width: 100%;
      padding: 10px;
      background: #111;
      color: #fff;
      border: 1px solid #333;
    }
    button {
      background: #222;
      color: #fff;
      padding: 10px 20px;
      border: none;
      margin-right: 10px;
      cursor: pointer;
    }
    button:hover {
      background: #444;
    }
    .notice {
      border: 1px solid #444;
      padding: 10px;
      margin-top: 10px;
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
</head>
<body>

<h1>üì¢ Notice Board</h1>
<button id="loginBtn">üîê Login with Google (Admin Only)</button>
<button id="logoutBtn" style="display:none;">üö™ Logout</button>

<div id="editorPanel">
  <h2>‚úèÔ∏è Manage Notices</h2>
  <input type="text" id="titleInput" placeholder="Notice Title">
  <textarea id="bodyInput" placeholder="Notice Body"></textarea>
  <button onclick="addNotice()">‚ûï Add Notice</button>
  <div id="notices"></div>
</div>

<script>
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const editorPanel = document.getElementById("editorPanel");
  const noticesDiv = document.getElementById("notices");

  auth.onAuthStateChanged(async (user) => {
    if (user) {
      try {
        await db.collection("admins").doc(user.uid).get(); // trigger read permission
        editorPanel.style.display = "block";
        loginBtn.style.display = "none";
        logoutBtn.style.display = "inline-block";
        loadNotices();
      } catch (e) {
        alert("‚õî Access denied.");
        auth.signOut();
      }
    }
  });

  loginBtn.onclick = () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider).catch(e => alert("‚ùå Login failed: " + e.message));
  };

  logoutBtn.onclick = () => {
    auth.signOut();
    editorPanel.style.display = "none";
    loginBtn.style.display = "inline-block";
    logoutBtn.style.display = "none";
  };

  function addNotice() {
    const title = document.getElementById("titleInput").value.trim();
    const body = document.getElementById("bodyInput").value.trim();
    if (!title || !body) return alert("Please enter both title and body.");

    db.collection("notices").add({ title, body, timestamp: Date.now() })
      .then(() => {
        document.getElementById("titleInput").value = "";
        document.getElementById("bodyInput").value = "";
        loadNotices();
      })
      .catch(e => alert("‚ùå Failed to add notice: " + e.message));
  }

  function loadNotices() {
    noticesDiv.innerHTML = "";
    db.collection("notices").orderBy("timestamp", "desc").get().then(snapshot => {
      snapshot.forEach(doc => {
        const notice = doc.data();
        const div = document.createElement("div");
        div.className = "notice";
        div.innerHTML = `
          <h3>${notice.title}</h3>
          <p>${notice.body}</p>
          <button onclick="editNotice('${doc.id}', '${notice.title}', \`${notice.body}\`)">‚úèÔ∏è Edit</button>
          <button onclick="deleteNotice('${doc.id}')">üóëÔ∏è Delete</button>
        `;
        noticesDiv.appendChild(div);
      });
    });
  }

  function deleteNotice(id) {
    if (confirm("Are you sure you want to delete this notice?")) {
      db.collection("notices").doc(id).delete().then(loadNotices);
    }
  }

  function editNotice(id, oldTitle, oldBody) {
    const title = prompt("Edit Title:", oldTitle);
    const body = prompt("Edit Body:", oldBody);
    if (title && body) {
      db.collection("notices").doc(id).update({ title, body }).then(loadNotices);
    }
  }
</script>

</body>
</html>
